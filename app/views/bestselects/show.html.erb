<div class="question px-4 py-6 sm:px-6 md:px-8 lg:px-10 max-w-3xl mx-auto" data-controller="bestselect" data-bestselect-bestselect-id-value="<%= @bestselect.id %>" data-bestselect-correct-value="<%= @correct || 0 %>" data-bestselect-total-value="<%= @total || 0 %>">
  <!-- 背景画像（レスポンシブ対応） -->
  <main class="pt-20">
    <section class="max-w-5xl mx-auto px-4 mt-4">
      <div class="relative min-h-[260px] sm:min-h-[320px] md:min-h-[400px] flex items-center justify-center">
        <%= image_tag @bestselect.image_filename,
          alt: "状況判断クイズのシーン",
          class: "max-w-full max-h-full object-contain" %>
      </div>
    </section>
  </main>

  <% if @bestselect.present? %>
    <!-- 進行状況 -->
    <div class="mb-4">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-sm sm:text-base text-gray-700">
        <div class="flex items-center gap-2">
          <span class="text-gray-500">現在</span>
          <span class="text-lg font-semibold text-gray-900"><%= @question_position %></span>
          <span class="text-gray-500">/ <%= @total_questions %> 問</span>
        </div>
        <div class="text-gray-600">
          あと <span class="font-semibold text-gray-900"><%= @remaining_questions %></span> 問
        </div>
      </div>
      <div class="w-full bg-gray-100 rounded-full h-2 mt-2 overflow-hidden">
        <div
          class="h-full bg-blue-600 rounded-full transition-all duration-300"
          style="width: <%= @progress_percent %>%">
        </div>
      </div>
    </div>

    <!-- 質問文 -->
    <h2 class="text-lg sm:text-xl md:text-2xl font-semibold mb-4 leading-relaxed">
      <%= @bestselect.question %>
    </h2>

    <!-- 選択肢 -->
    <ul class="answers space-y-3 mb-6">
      <% @bestselect.answers.each do |answer| %>
        <li
          class="p-4 border rounded-lg cursor-pointer bg-white shadow-sm
                hover:bg-gray-50 active:bg-gray-100
                transition-all text-base sm:text-lg"
          data-action="click->bestselect#choose"
          data-bestselect-correct-value="<%= answer.is_correct %>"
          data-choice-id="<%= answer.id %>"
          data-bestselect-target="answer"
        >
          <span class="mr-2 text-gray-500 font-medium"><%= answer.position %>.</span>
          <span><%= answer.body %></span>
        </li>
      <% end %>
    </ul>

    <!-- 結果 -->
    <div 
      class="mt-2 text-base sm:text-lg font-medium min-h-[1.5rem]"
      data-bestselect-target="result">
    </div>

    <!-- もう一度ボタン -->
    <button 
      type="button" 
      class="mt-3 text-sm sm:text-base text-blue-600 hover:text-blue-700 underline"
      data-action="bestselect#reset">
      もう一度
    </button>

    <!-- 解説 -->
    <div
      class="explanation mt-4 p-4 bg-gray-50 rounded border hidden
            text-sm sm:text-base leading-relaxed"
      data-bestselect-target="explanation">
      <h3 class="font-medium mb-2">解説</h3>
      <p><%= @bestselect.explanation %></p>
    </div>

    <!-- 次の問題 -->
    <% if @next_bestselect.present? && @next_bestselect.id != @bestselect.id %>
      <div class="mt-8">
        <%= link_to "次の問題へ",
          bestselect_path(@next_bestselect),
          class: "inline-flex items-center px-5 py-2.5 
                  bg-blue-600 text-white rounded-lg shadow
                  text-sm sm:text-base
                  hover:bg-blue-700 transition" %>
      </div>
    <% else %>
      <div class="p-4 text-center text-sm sm:text-base">
        <p>問題が見つかりません。`bin/rails db:seed` を実行してください。</p>
      </div>
    <% end %>
  <% end %>
  <div class="w-full flex justify-center items-center mt-6">
    <% if (@total || 0) > 0 %>
      <canvas 
        data-bestselect-target="chart"
        id="tactic-chart">
      </canvas> 
    <% end %>
  </div>
</div>
