<div 
  class="question px-4 py-6 sm:px-6 md:px-8 lg:px-10 
          max-w-3xl mx-auto"
  data-controller="bestselect"
  data-bestselect-current-id-value="<%= @bestselect.id %>"
>

<!-- 背景画像（レスポンシブ対応） -->
<div 
  class="relative bg-center bg-contain bg-no-repeat
         min-h-[220px] sm:min-h-[300px] md:min-h-[calc(100vh-134px)]"
  style="background-image: url('<%= asset_path(@bestselect.image_filename) %>');">
</div>

<% if @bestselect.present? %>
    <!-- 質問文 -->
    <h2 class="text-lg sm:text-xl md:text-2xl font-semibold mb-4 leading-relaxed">
      <%= @bestselect.question %>
    </h2>

    <!-- 選択肢 -->
    <ul class="answers space-y-3 mb-6">
      <% @bestselect.answers.each do |answer| %>
        <li
          class="p-4 border rounded-lg cursor-pointer bg-white shadow-sm
                 hover:bg-gray-50 active:bg-gray-100
                 transition-all text-base sm:text-lg"
          data-action="click->bestselect#choose"
          data-bestselect-correct-value="<%= answer.is_correct %>"
          data-choice-id="<%= answer.id %>"
          data-bestselect-target="answer"
        >
          <span class="mr-2 text-gray-500 font-medium"><%= answer.position %>.</span>
          <span><%= answer.body %></span>
        </li>
      <% end %>
    </ul>

    <!-- 結果 -->
    <div 
      class="mt-2 text-base sm:text-lg font-medium min-h-[1.5rem]"
      data-bestselect-target="result">
    </div>

    <!-- もう一度ボタン -->
    <button 
      type="button" 
      class="mt-3 text-sm sm:text-base text-blue-600 hover:text-blue-700 underline"
      data-action="bestselect#reset">
      もう一度
    </button>

    <!-- 解説 -->
    <div
      class="explanation mt-4 p-4 bg-gray-50 rounded border hidden
             text-sm sm:text-base leading-relaxed"
      data-bestselect-target="explanation">
      <h3 class="font-medium mb-2">解説</h3>
      <p><%= @bestselect.explanation %></p>
    </div>

    <!-- 次の問題 -->
    <% if @next_bestselect.present? && @next_bestselect.id != @bestselect.id %>
      <div class="mt-8">
        <%= link_to "次の問題へ",
          bestselect_path(@next_bestselect),
          class: "inline-flex items-center px-5 py-2.5 
                  bg-blue-600 text-white rounded-lg shadow
                  text-sm sm:text-base
                  hover:bg-blue-700 transition" %>
      </div>
    <% end %>
  </div>

<% else %>
  <div class="p-4 text-center text-sm sm:text-base">
    <p>問題が見つかりません。`bin/rails db:seed` を実行してください。</p>
  </div>
<% end %>
<div class="w-full flex justify-center items-center mt-6">
  <% if @total.to_i > 0 %>
    <canvas id="tactic-chart" class="sm:w-16 md:w-24 lg:w-48 mx-auto"></canvas>

    <script>
    document.addEventListener("DOMContentLoaded", () => {
      const ctx = document.getElementById("tactic-chart");
      if (!ctx) return;

      new Chart(ctx, {
        type: "doughnut",
        data: {
          labels: ["正解", "不正解"],
          datasets: [{
            data: [<%= @correct %>, <%= @total - @correct %>],
            backgroundColor: ["#2563eb", "#e5e7eb"]
          }]
        },
        options: { cutout: "65%" }
      });
    });
    </script>
  <% end %>
</div>