<div class="max-w-4xl mx-auto mt-6">
  <div class="relative">
    <video
      id="player-<%= @video.id %>"
      class="video-js vjs-default-skin w-full h-auto bg-black mx-auto max-w-4xl mt-6"
      controls
      preload="auto"
      playsinline
    >
      <% if @video.file.attached? %>
        <source src="<%= url_for(@video.file) %>" type="<%= @video.file.content_type %>">
        お使いのブラウザは動画タグに対応していません。
      <% else %>
        <p class="text-center text-red-600">動画ファイルが見つかりません。</p>
      <% end %>
    </video>
    <div
      id="tactic-overlay"
      data-video-id="<%= @video.id %>"
      class="pointer-events-none absolute inset-0 z-20"
    >
      <div
        id="tactic-badge-<%= @video.id %>"
        class="absolute hidden max-w-[80%]
              bg-white/85 backdrop-blur-sm text-gray-900
              text-sm md:text-base font-semibold
              rounded-md px-3 py-2
              shadow-xl ring-1 ring-black/10"
        style="transform: translate(-50%, -100%);"
      ></div>
    </div>
  </div>
</div>
<h3>タグ</h3>
<ul id="video-tags" class="flex gap-2 flex-wrap">
  <%= render partial: "videos/tag", collection: @video.tags, as: :tag, locals: { video: @video } %>
</ul>
<%= form_with url: video_video_tags_path(@video), method: :post, data: { turbo_stream: true } do %>
  <%= select_tag :tag_id, options_from_collection_for_select(Tag.order(:name), :id, :name) %>
  <%= submit_tag "追加" %>
<% end %>
<%= form_with url: video_video_tags_path(@video), method: :post, data: { turbo_stream: true } do %>
  <%= text_field_tag :name, nil, placeholder: "新しいタグ名" %>
  <%= submit_tag "作成して追加" %>
<% end %>
<div class="max-w-4xl mx-auto mt-6 p-4 bg-white shadow-md rounded">
  <h1 class="text-2xl font-bold mb-4"><%= @video.title %></h1>
  <p class="text-gray-700 mb-4"><%= @video.description %></p>
  <p class="text-sm text-gray-500 mb-2">公開設定: <%= @video.visibility %></p>
  <p class="text-sm text-gray-500 mb-2">長さ: <%= @video.duration_seconds.present? ? "#{@video.duration_seconds}秒" : "解析中…" %></p>
  <p class="text-sm text-gray-500">保存日時: <%= l(@video.created_at, format: :long) %></p>
  <div class="mt-4 flex space-x-2">
    <%= link_to "動画を編集", edit_video_path(@video), class: 'inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700' %>
    <%= link_to "動画一覧へ", videos_path, class: 'inline-block bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200' %>
    <%= link_to "削除", video_path(@video), data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" }, class: 'inline-block bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700' %>
  </div>
</div>

<h2 class="text-lg font-semibold mb-2">タイムライン</h2>
<div id="timelines_list">
  <%= render partial: "timelines/list", locals: { timelines: @video.timelines.order(:start_seconds) } %>
</div>

<%= form_with model: [@video, Timeline.new], data: { turbo_stream: true } do |f| %>
  <div class="mb-4">
    <%= f.label :start_seconds, "開始時間 (秒)", class: "block text-sm font-medium text-gray-700" %>
    <%= f.number_field :start_seconds, step: "0.01", class: "mt-1 block w-full border rounded p-2" %>
  </div>

  <div class="mb-4">
    <%= f.label :kind, "種別", class: "block text-sm font-medium text-gray-700" %>
    <%= f.select :kind, Timeline::KINDS.map { |k| [k.titleize, k] }, { include_blank: false }, class: "mt-1 block w-full border rounded p-2" %>
  </div>

  <div class="mb-4">
    <%= f.label :body, "ノート / 説明", class: "block text-sm font-medium text-gray-700" %>
    <%= f.text_area :body, rows: 3, class: "mt-1 block w-full border rounded p-2" %>
  </div>

  <div>
    <%= f.submit "タイムラインを追加", class: "bg-green-600 text-black px-4 py-2 rounded hover:bg-green-700" %>
  </div>
<% end %>